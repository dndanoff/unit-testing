<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MovieTicketPro.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">unit-test-demo</a> &gt; <a href="index.source.html" class="el_package">io.github.dndanoff.movie.service</a> &gt; <span class="el_source">MovieTicketPro.java</span></div><h1>MovieTicketPro.java</h1><pre class="source lang-java linenums">package io.github.dndanoff.movie.service;

import java.util.List;

import javax.swing.JOptionPane;

import io.github.dndanoff.movie.model.BookingException;
import io.github.dndanoff.movie.model.ErrorType;
import io.github.dndanoff.movie.model.Movie;
import io.github.dndanoff.movie.model.MovieHall;
import io.github.dndanoff.movie.model.ShowTime;
import io.github.dndanoff.movie.repository.MovieDao;

<span class="fc" id="L14">public class MovieTicketPro {</span>

	public void book(Movie movie, ShowTime time, int noOfTickets) {
<span class="fc" id="L17">		MovieDao dao = getMovieDao();</span>
<span class="fc" id="L18">		MovieHall hall = dao.findMovie(movie, time);</span>
<span class="fc bfc" id="L19" title="All 2 branches covered.">		if (hall != null) {</span>
<span class="fc" id="L20">			List&lt;String&gt; seats = dao.getAvilableSeats(movie, time);</span>
<span class="fc bfc" id="L21" title="All 2 branches covered.">			if (seats.size() &lt; noOfTickets) {</span>
<span class="fc" id="L22">				getErrorMessageDisplayer().showMessage(&quot;Booking message&quot;, &quot;Ticket is not available&quot;,</span>
						JOptionPane.WARNING_MESSAGE);
<span class="fc" id="L24">				return;</span>
			}
<span class="fc" id="L26">			int booked = 0;</span>
<span class="fc" id="L27">			String bookedSeats = &quot;&quot;;</span>
<span class="pc bpc" id="L28" title="1 of 2 branches missed.">			for (String aSeat : seats) {</span>
				try {
<span class="fc" id="L30">					dao.book(movie, time, aSeat);</span>
<span class="fc" id="L31">					bookedSeats += &quot; &quot; + aSeat;</span>
<span class="fc" id="L32">					booked++;</span>
<span class="pc bpc" id="L33" title="1 of 2 branches missed.">					if (booked == noOfTickets) {</span>
<span class="fc" id="L34">						getErrorMessageDisplayer().showMessage(&quot;Booking Info&quot;,</span>
								&quot;Following tickets&quot; + bookedSeats + &quot; Booked&quot;, JOptionPane.ERROR_MESSAGE);
<span class="fc" id="L36">						break;</span>
					}
<span class="nc" id="L38">				} catch (BookingException e) {</span>
<span class="nc bnc" id="L39" title="All 2 branches missed.">					if (ErrorType.SEAT_ALREADY_BOOKED.equals(e.getType())) {</span>
<span class="nc" id="L40">						boolean yes = getErrorMessageDisplayer().showConfirmMessage(&quot;Booking message&quot;,</span>
								&quot;Adjacent seats not available. Can I book any other seat?&quot;);
<span class="nc bnc" id="L42" title="All 2 branches missed.">						if (yes) {</span>
<span class="nc" id="L43">							getErrorMessageDisplayer().showMessage(&quot;Booking information&quot;,</span>
									&quot;Going to auto allocate seats.&quot;, JOptionPane.INFORMATION_MESSAGE);
<span class="nc" id="L45">							continue;</span>
						}
<span class="nc" id="L47">						break;</span>
					}
<span class="nc" id="L49">				} catch (Exception e) {</span>
<span class="nc" id="L50">					getErrorMessageDisplayer().showMessage(&quot;Booking Error&quot;, &quot;Could not book ticket&quot;,</span>
							JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L52">					break;</span>
<span class="nc" id="L53">				}</span>
<span class="nc" id="L54">			}</span>
<span class="fc" id="L55">		} else {</span>
<span class="fc" id="L56">			getErrorMessageDisplayer().showMessage(&quot;Booking message&quot;, &quot;Movie or showtime not available&quot;,</span>
					JOptionPane.WARNING_MESSAGE);
		}
<span class="fc" id="L59">	}</span>

	ErrorMessageDisplayer getErrorMessageDisplayer() {
<span class="nc" id="L62">		return new BookingErrorController();</span>
	}

	MovieDao getMovieDao() {
<span class="nc" id="L66">		return new MovieDao();</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>